<!doctype html>
<html>
<head>
<title></title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<style>
 body {font-family:helvetica,arial;margin:0;padding:0}
 #dip {display:none;min-height:298mm} #dip:hover{opacity:0.7}
 .vignette {transform:scale(0.3);transform-origin:left top;cursor:pointer}
 .spin{width:70px;text-align:center}.spin>div{width:18px;height:18px;background-color:#ADADAD;border-radius:100%;display:inline-block;-webkit-animation:bouncedelay 1.4s infinite ease-in-out;animation:bouncedelay 1.4s infinite ease-in-out;-webkit-animation-fill-mode:both;animation-fill-mode:both}.spin .bnc1{-webkit-animation-delay:-0.32s;animation-delay:-0.32s}.spin .bnc2{-webkit-animation-delay:-0.16s;animation-delay:-0.16s}@-webkit-keyframes bouncedelay{0%,80%,100%{-webkit-transform:scale(0.0)}40%{-webkit-transform:scale(1.0)}}@keyframes bouncedelay{0%,80%,100%{transform:scale(0.0);-webkit-transform:scale(0.0)}40%{transform: scale(1.0);-webkit-transform: scale(1.0)}}
</style>
<script src="JQ.js"></script>
<script src='pdf/jspdf.min.js'></script><script src='pdf/addimage.js'></script><script src='pdf/png_support.js'></script>
<!-- <script src='pdf/split_text_to_size.js'></script><script src='pdf/standard_fonts_metrics.js'></script> -->
<script>
 var D,resume,vignette,html,und=undefined;
 var isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
 var isIE = /Edge\/|Trident\/|MSIE /.test(window.navigator.userAgent);
 function init(){
	vignette=UrlVars()['v']!=und;
	html=UrlVars()['h']!=und;
	if (vignette||html) {
		$('#dip').show();
		if (vignette) { document.body.style.overflow='hidden'; $('#dip').addClass('vignette') }
	}
	else {document.getElementById('output').style.height=window.innerHeight+'px'}
	resume=eval('('+localStorage["res"]+')');
	var mdp=localStorage["mdip"];
	var mdpcourse=mdp; if(resume.course!=und&&resume.course>'') mdpcourse=mdp.replace('.mdp','-'+resume.course+'.mdp');
	$.ajax({type:"GET",url:mdpcourse,dataType:"xml",
		success:parseMdp,
		error:function(xhr,st,er){
			if(mdpcourse!=mdp) { $.ajax({type:"GET",url:mdp,dataType:"xml",success:parseMdp,error:function(xhr,st,er){$('#chgt').hide();alert("Error loading mdp file: "+er)} }); return}
			$('#chgt').hide();alert("Error loading mdp file: "+er)
		}
	});
 }
 function UrlVars(){var v=[],h,hh=window.location.href.slice(window.location.href.indexOf('?')+1).split('&');for(i=0;i<hh.length;i++){h=hh[i].split('=');v.push(h[0]);v[h[0]]=h[1]}return v}
 function PDF(){
	try {
		var unit=D.unite,orientation=(D.paysage?'landscape':'portrait');
		var zoompdf=1; if(D.paysage)zoompdf=0.7;
		var doc=new jsPDF(orientation,unit,"A4");
		doc.setFont('Arial');
		for(var n=1;n<3;n++){
			for(var i=0;i<D.Objets.length;i++){
				var O=D.Objets[i];
				if(O.type==1&&n==1){
					doc.addImage(imgs[O.image],"JPEG",O.x*zoompdf,O.y*zoompdf,O.largeur*zoompdf,O.hauteur*zoompdf);
				} else if(O.type!=1&&n==2) {
					// alignement, souligné, italique
					doc.setFontSize(O.fontsize);
					if(O.gras)doc.setFont("Arial","bold"); else doc.setFont("Arial","normal");
					doc.setTextColor(0); if(O.clTxt>''){var rgb=O.clTxtRGB.split(',');doc.setTextColor(Number(rgb[0]),Number(rgb[1]),Number(rgb[2]))}
					var x=O.x; if (O.align=='1') x+=(O.largeur/2); if (O.align=='2') x+=O.largeur;
					var txtWidth=doc.getStringUnitWidth(String(O.texte))* (Number(O.fontsize) / (72/25.6));
					txtWidth=txtWidth * zoompdf;
					if (O.align=='1')x-=(txtWidth/2); if (O.align=='2')x-=txtWidth;
					doc.text(x*zoompdf,O.y*zoompdf + (Number(O.fontsize) / (72/25.6)),String(O.texte));
				}
			}
		}
		$('#chgt').hide();
		var nomfich=resume.txtDip.replace('&ocirc;','o') + " -" + resume.nevt.replace('/','').replace('\\','').replace(':','') + ".pdf";
		if (isChrome){
			var F=document.getElementById('output');
			$('#output').show();
			F.src=doc.output('datauristring');
			//doc.output('datauri');
		}
		else if(isIE)
			doc.output('save', nomfich);
		else
			doc.save(nomfich);
	}
	catch(ex){
		console.log(ex.message);
		$('#chgt').hide();
		window.open('diplome-pdf.html?h=1','_blank');
	}
 }
 function pdfdepuisvignette(){
	if(!vignette)return;
	if(isChrome)
		window.open('diplome-pdf.html','_blank');
	else
		document.location.replace('diplome-pdf.html');
 }
 function getBase64Image(url){
	var img=new Image(),dataURL;
	img.onerror=function(){
		nbImgsChargees++;
		if(nbImgsChargees==nbImgs) PDF();
	}
	img.onload=function(){
		var canvas = document.createElement('canvas'); canvas.width=img.width; canvas.height=img.height;
		var context=canvas.getContext('2d');
		context.drawImage(img,0,0);
		dataURL=canvas.toDataURL('image/jpeg');
		imgs[url]=dataURL;
		nbImgsChargees++;
		if(nbImgsChargees==nbImgs) PDF();
	}
	var path=dirname(localStorage["mdip"]) + '/'; if(path=='/')path='';
	img.src=path+url;
 }
 function xml2Sng(v){if(v==und)return 0;if(v.length==0||isNaN(v))return 0;num=v/1000;return Math.round(num*Math.pow(10,2))/Math.pow(10,2)}
 function pxTomm(px){return Math.floor(px/$('#my_mm').width())}
 function basename(path){return path.replace(/\\/g,'/').replace( /.*\//, '' );}
 function dirname(path){return path.replace(/\\/g,'/').replace(/\/[^\/]*$/, '');}
 var nbImgs=0,nbImgsChargees=0,imgs=[];
 function parseMdp(xml,code,xhr){
	var s='';
	D=new Object();
	var xD=$(xml).find("Objets");
	D.nom=xD.attr("nom");
	D.unite='mm';
	if(xD.attr("largeurMM")>''){D.largeurMM=xml2Sng(xD.attr("largeurMM")); D.hauteurMM=xml2Sng(xD.attr("hauteurMM"));}
	D.paysage=xD.attr("paysage")=="1";
	D.Objets=[];
	if(xD.attr("unite")=='4')D.unite='in';
	xD.find("O").each(function(i){
		var O=new Object();
		O.x=$(this).attr('X'); if(O.x==und) O.x=xml2Sng($(this).attr('XX')); O.x=Number(O.x);
		O.y=$(this).attr('Y'); if(O.y==und) O.y=xml2Sng($(this).attr('YY')); O.y=Number(O.y);
		O.hauteur=$(this).attr('H'); if(O.hauteur==und) O.hauteur=xml2Sng($(this).attr('HH'));
		O.largeur=$(this).attr('L'); if(O.largeur==und) O.largeur=xml2Sng($(this).attr('LL'));
		O.nom=$(this).attr('nom');
		O.texte=$(this).attr('texte');
		O.gras=$(this).attr('fb')=='1';
		O.souligne=$(this).attr('fu')=='1';
		O.italique=$(this).attr('fi')=='1';
		O.clTxt='';if($(this).attr('clt')!=und){O.clTxt=$(this).attr('clt');O.clTxtRGB=$(this).attr('cltrgb');}
		if($(this).attr('tp')!=und) O.fontsize=xml2Sng($(this).attr('tp'));
		else {O.fontsize=$(this).attr('fs'); if(O.fontsize.indexOf(',')>0)O.fontsize=Number(O.fontsize.split(',')[0]);}
		if(O.fontsize==und||O.fontsize=='')O.fontsize=10;
		O.variable=$(this).attr('var');
		O.type=$(this).attr('type');
		O.align=$(this).attr('al');if(O.align==und)O.align='';
		O.image=$(this).attr('ci');
		if(O.image!=und){
			if(O.image.lastIndexOf('/') >= 0) O.image=O.image.substring(O.image.lastIndexOf('/')+1);
			if(O.image.lastIndexOf('\\') >= 0) O.image=O.image.substring(O.image.lastIndexOf('\\')+1);
			O.dataURL='';
			if(!(vignette||html)) getBase64Image(O.image);
			nbImgs++;
		}
		O.zoomimage=$(this).attr('zi'); if(O.zoomimage==und) O.zoomimage=xml2Sng($(this).attr('zii'));
		if(O.zoomimage==und||O.zoomimage==0)O.zoomimage=1;

		if(O.type==1){
			var d=dirname(localStorage["mdip"]); if(d==localStorage["mdip"])d=""; path = d + '/'; if(path=='/')path='';
			s += '<img src="'+path+O.image+'" style="position:absolute;z-index:5;left:'+O.x+D.unite+';top:'+O.y+D.unite+';width:'+O.largeur+D.unite+';height:'+O.hauteur+D.unite+';padding-bottom:20'+D.unite+';padding-right:20'+D.unite+'" />';
		} else {
			var txt=O.texte;
			if (O.variable!=und) { txt=getVar(O.variable); if(txt==='undefined'||txt==und){console.log('variable ko: '+O.variable); txt='';} }
			var x=O.x; if (O.align=='1') x+=(O.largeur/2); if (O.align=='2') x+=O.largeur;
			s+='<div alg="'+O.align+'" x="'+x+'" style="position:absolute;z-index:10;left:'+x+D.unite+';top:'+O.y+D.unite+';font-size:'+O.fontsize+'pt';
			if(O.gras) s+=';font-weight:bold';
			if(O.souligne) s+=';text-decoration:underline';
			if(O.italique) s+=';font-style:italic';
			if(O.clTxt>'') s+=';color:'+O.clTxt;
			s+='">'+txt +'</div>';
			O.texte=txt;
		}
		D.Objets.push(O);
	});
	document.getElementById('dip').innerHTML = s;
	document.getElementsByTagName('title')[0].innerHTML=resume.txtDip;
	$("div[alg='1']").each(function(i){
		this.style.left=(this.offsetLeft-(this.offsetWidth/2))+'px'
	});
	$("div[alg='2']").each(function(i){
		this.style.left=(this.offsetLeft-this.offsetWidth)+'px'
	});

	if(nbImgs==0 && !(vignette||html)) PDF();
	if(vignette||html) $('#chgt').hide();
 }
 function getVar(v){
	try {
	 v=Number(v); var br="\r\n"; if(vignette||html)br='<br>';
	 switch(v){
		case 21: return resume.dos;
		case 7: return resume.eng.club;
		case 5: return resume.lblCat;
		case 6: return resume.eng.ser;
		case 2: case 3:
			var n=resume.eng.nom; if(n.indexOf(' ')>0)n=n.split(' ')[v=='2'?0:1]; return n;
		case 4: return resume.eng.nom;
		case 68: return getNomprenomInitiales(resume.eng.nom);
		case 19: return resume.course;
		case 29: return resume.moy;
		case 28: return resume.distCourse;
		case 30: return resume.plCourse;
		case 31: return resume.plCat;
		case 22: return resume.sTemps;
		case 35: return resume.diplome;
		case 47: return resume.tours;
		case 48: return resume.parcouru;
		case 52: return resume.lblCat;
		case 55: var s='';
			for(var i=0;i<resume.Ptges.length;i++){if(resume.Ptges[i]==und||resume.Ptges[i]=='')continue; s+=(i==0?'':br)+resume.tabPE[i].nom+' : '+resume.Ptges[i]+' ('+resume.PlacesPtgs[i].scratch+'°)'}
			return s;
		case 56: var s='';
			for(var i=0;i<resume.Segs.length;i++){if(resume.Segs[i]==und||resume.Segs[i]=='')continue; s+=(i==0?'':br)+resume.tabSE[i].nom+' : '+resume.Segs[i]+' ('+resume.PlacesSeg[i].scratch+'°)'}
			return s;
		case 23: return resume.sDepart;
		case 40: return resume.sTempsReel;
		case 38: return resume.nbEngCourse;
		// sx, nat, année, licence, age
		// nom épreuve
	 }
	}catch(ex){}
	if(v>=100&&v<199){return resume.eng.IPs[v-100]}
	if(v>=200&&v<299){return resume.Ptges[v-200]}
	if(v>=300&&v<399){return resume.Segs[v-300]}
	return '';
 }
 function getNomprenomInitiales(np){
	if(np==undefined)return ''; if (np.split('\xa0').length<2) return np;
	var p=getPrenom(np),n=getNom(np),ip='',w=p.split(' ');
	for(var i=0;i<w.length;i++){if(w[i]>'')ip+=w[i].substring(0, 1).toUpperCase()+'.'}
	return ip+' '+n;
 }
</script>
</head>
<body onload="init()">
 <div id="my_mm" style="height:1mm;width:1mm;display:none"></div>
 <div class="spin" id="chgt" style="display:flex;margin:30px"><div class="bnc1"></div><div class="bnc2"></div><div class="bnc3"></div></div>
 <div id="dip" onclick="pdfdepuisvignette()"></div>
 <iframe id="output" style="border:0;width:100%;height:500px;display:none"></iframe>
</body>
</html>
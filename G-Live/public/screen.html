<!DOCTYPE html>
<html>
<head>
	<title>G-Live</title>
	<meta charset="utf-8">
	<meta name="version" content="1.5">
	<meta name="viewport" content="width=device-width,initial-scale=1.0">
	<meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<BASE href="/" />
	
	<style>
	@font-face{font-family:'BN';src:url('police/BN.woff') format('woff'),url('police/BN.ttf') format('truetype');font-weight:normal;font-style:normal}
	@font-face{font-family:"Noodle";font-style:normal;font-weight:normal;src:url("police/noodle.woff") format("woff"),url("police/noodle.ttf") format("truetype")}
	html,body{margin:0;padding:0;overflow:hidden;font-family:arial}
	.widget {overflow:hidden}
	.liste {display:table} .liste>div,.entete {display:table-row} .col {display:table-cell;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-left:4px;vertical-align:baseline}
	.titrehorloge, .titreliste {white-space:nowrap}
	.entete {font-size:75%}
	.crs0>div:first-child{border-left:3px solid #D5E217}.crs1>div:first-child{border-left:3px solid #FD3759}.crs2>div:first-child{border-left:3px solid #459EFF}.crs3>div:first-child{border-left:3px solid #FFF}.crs4>div:first-child{border-left:3px solid #FFAE00}.crs5>div:first-child{border-left:3px solid #555}
	</style>

	<script src="g-live.settings.js"></script><script src="JQ.js"></script><script src="g-live.translations.js"></script>
	<script>
	var und=undefined,LG;
	var CFG=new Object(); CFG.Courses=[]; CFG.Pointages=[]; CFG.Troncons=[];
	function ById(i){return document.getElementById(i)}function Num(n){return Number(n)}
	function vis(id,yes){var v=(yes)?'':'none';if(ById(id).style.display!=v)ById(id).style.display=v}
	function html(id,h){if(ById(id).innerHTML!=h)ById(id).innerHTML=h}function htmlO(o,h){if(o.innerHTML!=h)o.innerHTML=h}
	function hEnt(str){return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}
	function txt(id){try{return Translations[LG][id]}catch(e){return id}}function son(s){try{new Audio(s).play()}catch(e){}}
	function UrlVars(){var v=[],h,hh=window.location.href.slice(window.location.href.indexOf('?')+1).split('&');for(i=0;i<hh.length;i++){h=hh[i].split('=');v.push(h[0]);v[h[0]]=h[1]}return v}
	function basename(p){return p.replace(/\\/g,'/').replace( /.*\//,'')} function dirname(p){return p.replace(/\\/g,'/').replace(/\/[^\/]*$/,'')}
	//function addCSS(css){try{document.styleSheets[0].insertRule(css,0)}catch(e){console.log('addCSS : '+e+' - '+css)}}
	function addCSS(css){
	 var head=document.head || document.getElementsByTagName('head')[0],styleTag = document.createElement('style');
	 styleTag.type='text/css';
	 if (styleTag.styleSheet) styleTag.styleSheet.cssText = css
	 else styleTag.appendChild(document.createTextNode(css))
	 head.appendChild(styleTag)
	}
	//function addStyleSheet(ss){var L=document.createElement("link"); L.setAttribute("rel","stylesheet"); L.setAttribute("type","text/css"); L.setAttribute("href",ss); document.head.appendChild(L)}
	function x2Sng(v){if(v==und)return 0;if(v.length==0||isNaN(v))return 0;num=v/1000;return Math.round(num*Math.pow(10,2))/Math.pow(10,2)}
	function mefDist(dist){if(CFG.uniteDist==1)return dist+' '+txt(dist==1?13:15); return dist+' '+txt(dist==1?12:14)}
	function getNom(np){if(np==undefined)return '';if(np.split('\xa0').length<2) return np; return np.split('\xa0')[CFG.prenomPuisNom?1:0]}
	function getPrenom(np){if(np==undefined)return '';if(np.split('\xa0').length<2) return np; return np.split('\xa0')[CFG.prenomPuisNom?0:1]}
	function getNomprenomInitiales(np){
		if(np==undefined)return ''; if (np.split('\xa0').length<2) return np;
		var p=getPrenom(np),n=getNom(np),ip='',w=p.split(' ');
		for(var i=0;i<w.length;i++){if(w[i]>'')ip+=w[i].substring(0, 1).toUpperCase()+'.'}
		return ip+' '+n;
	}
	function indiceDsListe(indice,liste){if(liste==undefined)return false; if(indice==liste)return true; return (','+liste+',').indexOf(','+indice+',')>=0}

	var LiveDispo=0,socket,config;
	$.getScript(urlSocketIO,function(){
		LiveDispo=1; //document.title+=' (live dispo)';
		socket=io.connect(liveNodeServer); socket.on('field',function(data){infolive(data)});
		if (config) socket.emit('screenconfig', config);
	});
	function loadConfig(){
		//var UV=UrlVars(),c=UV["cfg"];if(c==und)return;
		if(LG==und&&typeof localStorage!='undefined')LG=localStorage.lg;if(LG==und)LG=deflang;if(isNaN(LG)||LG>Translations.length-1)LG=0;
		var href=window.location.href,i=href.toLowerCase().indexOf('/screen/');
		config=decodeURI(href.substring(i+8,120));
		if (config.indexOf('?') > 0) {/*....*/}
		//addStyleSheet(config+'.css');
		$.getJSON(config+".screenconfig.json",
			function(json){
				CFG=json;
				CFG.nom=config;
				if(CFG.Courses==und)CFG.Courses=[]; if(CFG.Pointages==und)CFG.Pointages=[]; if(CFG.Troncons==und)CFG.Troncons=[];
				initEcran();
				initAnimations();
			}).fail( function(d, textStatus, error) {
				if (error=='Not Found') document.body.innerHTML='<p style="background:orange;color:white;padding:6px;margin:0">Error: configuration \''+config+'\' not found</p>';
				console.error("getJSON failed, status: " + textStatus + ", error: "+error)
			});
		if (socket) socket.emit('screenconfig', config);
	}
	function initEcran(){
		// [plein écran]
		// css global
		if(CFG.css>'') addCSS(CFG.css)
		// fond
		$('html').css('background-color',CFG.bg).css('color',CFG.fg);
		if(CFG.lg<800)$('html').css('font-stretch','ultra-condensed');
		// widgets
		CFG.DicWidgets=[];
		CFG.Animations=[];
		for(var i=0;i<CFG.Widgets.length;i++){
			var widget=CFG.Widgets[i];
			CFG.DicWidgets['w'+widget.id]=widget;
			if(widget.typeW==5){CFG.Animations.push(widget); continue}
			
			var frag=document.createDocumentFragment();
			frag.appendChild(document.createElement('div'));
			var w=frag.firstChild;
			w.className='widget';
			w.setAttribute("id",'w'+widget.id);
			w.setAttribute("type",widget.typeW);
			w.style.width=widget.lg+'px'; w.style.height=widget.ht+'px'; w.style.position='fixed'; w.style.left=widget.x+'px'; w.style.top=widget.y+'px';
			if(widget.bg!=und) w.style.backgroundColor=widget.bg;
			if(widget.fg!=und) w.style.color=widget.fg;
			if(widget.taillePolice!=und) w.style.fontSize=widget.taillePolice+'px';
			if(widget.invisible) w.style.opacity=0;
			switch (Num(widget.typeW)){
				case 0: // label
					w.setAttribute("label",widget.label);
					var s = widget.label, cssLabel = '', indsep = s.indexOf(';');
					if (indsep > 0) {s = s.substring(0,indsep); cssLabel = widget.label.substring(indsep+1,widget.label.length)}
					w.setAttribute('style',w.getAttribute('style')+';'+cssLabel);
					var html=s.replace(/{(\w+)}/g,'<span variable="$1"></span>').replace(/\r\n/g,'<br>');
					w.innerHTML=html;
					break;
				case 1: // horloge
					// titre - avec variables
					if (widget.titre!=und && widget.titre>'') w.innerHTML += '<div class="titrehorloge" label="'+hEnt(widget.titre)+'" style="'+(widget.cssTitre!=und?widget.cssTitre:'')+'">'+hEnt(widget.titre).replace(/{(\w+)}/g,'<span variable="$1"></span>') + '</div>';
					// ....valeur variable si nom course
					w.innerHTML += '<div class="horloge"></div>';
					break;
				case 2: // tableau de passages ou top coureurs
					if (widget.passagesRecents) w.setAttribute('passagesrecents','1');
					if (widget.classement) w.setAttribute('classement','1');
					if (widget.general) w.setAttribute('general','1');
					if (widget.cltEquipes) w.setAttribute('cltequipes','1');
					if (widget.coureursAuDepart) w.setAttribute('coureursAuDepart','1');
					if (widget.coureursAttendus) w.setAttribute('coureursAttendus','1');
					if (widget.styleLigne==und) widget.styleLigne='';
					addCSS('#w'+widget.id+'>div.liste>div {height:'+widget.htLignes+'px;' + widget.styleLigne + '}');
					addCSS('#w'+widget.id+' .col {line-height:'+widget.taillePolice+'px}');
					if (widget.bgLignesImpaires!=und) addCSS('#w'+widget.id+'>div.liste>div:nth-child(even) {background-color:'+widget.bgLignesImpaires+'}');
					if (widget.fgLignesImpaires!=und) addCSS('#w'+widget.id+'>div.liste>div:nth-child(even) {color:'+widget.fgLignesImpaires+'}');
					// titre - avec variables
					if (widget.titre!=und && widget.titre>'') {
						var titre = widget.titre, cssTitre = '', indsep = titre.indexOf(';');
						if (indsep > 0) {titre = titre.substring(0,indsep); cssTitre = widget.titre.substring(indsep+1,widget.titre.length)}
						w.innerHTML += '<div class="titreliste" label="'+hEnt(titre)+'" style="'+cssTitre+'">'+hEnt(titre).replace(/{(\w+)}/g,'<span variable="$1"></span>') + '</div>';
					}
					var colonnage=widget.colonnage,colonnageHorz=widget.flowH; if(colonnage==und) colonnage=0;
					// entête
					var entete='<div class="entete">',avec=0;
					for (var j=0;j<widget.colonnes.length;j++){var s=widget.colonnes[j].entete; if(s==und)s=''; entete+='<div class="col" style="width:'+widget.colonnes[j].lg+'px;max-width:'+widget.colonnes[j].lg+'px">'+(s==''?'&nbsp;':s)+'</div>'; if(s.length>0)avec=1;}
					entete+='</div>';
					if (!avec) entete='';
					// tableau
					var stliste = ''; if (colonnage>1) stliste += 'width:'+widget.lg+'px;-webkit-column-count:'+colonnage+';-moz-column-count:'+colonnage+';column-count:'+colonnage;
					w.innerHTML += entete + '<div class="liste" style="'+stliste+'"></liste>';
					if (colonnage>1) {addCSS('#w'+widget.id+'>div.liste>div {display:inline-block;display:inline-table}'); addCSS('#w'+widget.id+'>div.liste {display:'+ (colonnageHorz?'table':'inline-block') +'}')}
					break;
				case 4: // image
					w.style.textAlign = 'center';
					w.style.display = 'table';
					var html = '<span style="display:table-cell;vertical-align:middle"><img src="data:image/png;base64,'+widget.image+'" style="margin:auto;';
					if (widget.layout==3&&widget.lgImg!=undefined){ //stretched
						var zoomLg=widget.lg/widget.lgImg,zoomHt=widget.ht/widget.htImg;
						var zoom=zoomLg; if(zoomHt<zoomLg)zoom=zoomHt;
                    	var lg=Math.trunc(widget.lgImg*zoom),ht=Math.trunc(widget.htImg*zoom)
						html+=';width:'+lg+'px;height:'+ht+'px';
					}
					html += '" /></span>';
					w.innerHTML = html;
					break;
			}
			document.body.appendChild(frag);
		}
	}
	function initAnimations(){
		if(CFG.Animations==und) return;
		for(var i=0;i<CFG.Animations.length;i++){
			try {
				var Anim = CFG.Animations[i], idAnim = 'Anim_'+i, frequence = Anim.freq, demarrer = false;
Anim.enboucle=true;
				var css = '', tpsSequence = 0;
				for(var j=0;j<Anim.Etapes.length;j++){
					var Etape = Anim.Etapes[j];
					var dureeEtape = Etape.tps;
					var s = '@keyframes '+idAnim+Etape.widget+'{0%{opacity:0}5%{opacity:1}95%{opacity:1}} ';
					addCSS(s); addCSS(s.replace('@keyframes','@-webkit-keyframes'));
					s = 'Body.' + idAnim + ' #w' + Etape.widget + ' {transition:all 1s ease-in-out;animation:'+idAnim+Etape.widget+' ' + dureeEtape + 's ease-in-out'
					  + ';animation-delay:'+tpsSequence+'s' 
					  //+ (Anim.enboucle?';animation-iteration-count:infinite':'')
					  + '} ';
					addCSS(s); addCSS(s.replace('animation','-webkit-animation'));
					tpsSequence+=dureeEtape;
				}
				if (demarrer) {
					startAnim(i);
				}
			}catch(e){console.log('Animation '+i+': '+e)}
		}
	}
	function startAnim(ind){
		stopAnim(ind); 
		setTimeout(function(){$('body').addClass('Anim_'+ind)},50);
		if(CFG.Animations[ind].enboucle) CFG.Animations[ind].timer = setTimeout(function(){startAnim(ind)},CFG.Animations[ind].freq*1000)
	}
	function stopAnim(ind){
		if(CFG.Animations[ind].timer) clearTimeout(CFG.Animations[ind].timer); 
		$('body').removeClass('Anim_'+ind);
	}
	function infolive(data_,ti){
		try{
			var td=data_.split("\247"),i,j,ind; //247=§
			var idwidget=0;
			switch(td[0]){
				case "W": // rechargement page
					if (CFG.nom==td[1]) document.location.reload();
					break;
				case "IG": // infos générales
					CFG.uniteDist=td[1];
					if(td.length>1) CFG.prenomPuisNom=td[2]=='1';
					break;
				case "TC": // tableau courses
					CFG.Courses = []; for(i=1;i<td.length;i++) CFG.Courses.push(td[i]);
					majLibellesCourse();
					break;
				case "TP": // tableau pointages
					CFG.Pointages = []; for(i=1;i<td.length;i++) CFG.Pointages.push(td[i]);
					majLibellePtgTron();
					break;
				case "TT": // tableau tronçons
					CFG.Troncons = []; for(i=1;i<td.length;i++) CFG.Troncons.push(td[i]);
					majLibellePtgTron();
					break;
				case "CA": // nv course active (général)
					if (CFG.nom!=td[1]) break;
					CFG.courseActive=td[2];
					majLibellesCourse();
					break;
				case "VW": // visibilité widget sur demande
					if (td[1]!=CFG.nom) break;
					idwidget=td[2]; var visible=Num(td[3]);
					//....effets
					if(visible) ById('w'+idwidget).style.opacity=1;
					else ById('w'+idwidget).style.opacity=0;
					break;
				case "IW": // commande à destination d'un widget
					if (CFG.nom!=td[1]) break;
					idwidget=td[2]; var cmd=td[3],val=td[4];
					var widget=CFG.DicWidgets['w'+idwidget];
					// modif course ou pointage actif sur liste : vidage liste + maj variables titre
					if(cmd=="course") {widget.indCourse = Num(val); majLibellesCourse();}
					if(cmd=="ptg") {widget.indPointage = Num(val); majLibellePtgTron();}
					if(cmd=="tro") {widget.indTroncon = Num(val); majLibellePtgTron();}
					break;
				case "STARTA": case "STOPA": // start/stop animation
					if (td[1]!=CFG.nom) break;
					var indAnim = 99;
					for (var ind=0;ind<CFG.Animations.length;ind++) if (Num(CFG.Animations[ind].id) == Num(td[2])) indAnim = ind;
					if (td[0]=='STARTA') startAnim(indAnim);
					else stopAnim(indAnim);
					break;
				case "C": //temps horloge
					$("div.widget[type='1']").each(function(ind){
						var widget=CFG.DicWidgets[this.id];
						var indCourse=getCourseWidget(widget);
						if (indCourse!=Num(td[4])) return;
						var hh=td[(widget.rebours?5:2)];
						$(this.getElementsByClassName('horloge')[0]).html(hh);
					});
					break;
				case "CN": //nbHorloges + infoEtape + courseActive
					break;
				case "M": //infos Tours - nbcourus/restants/meilleurs temps
					var mt=JSON.parse(td[1]);
					for (i=-1;i<CFG.Courses.length;i++){
						var indCrs=i,infMT=mt.M[i+1]; //premier -1 p. ttes courses
						majSpanVariable(8,infMT.temps,indCrs); // meilleur tour (temps)
						nomsMT=infMT.noms;
						majSpanVariable(18,nomsMT,indCrs); majSpanVariable(19,getNom(nomsMT),indCrs); majSpanVariable(20,getNomprenomInitiales(nomsMT),indCrs); // meilleur tour (nom et variantes)
						majSpanVariable(11,infMT.nbToursCourus,indCrs);
						majSpanVariable(12,infMT.nbToursRestant,indCrs);
					}
					break;
				case "N": //progressions
					for(i=1;i<td.length;i++){
						var ti=td[i].split('\244'); if (ti[1]!='R') continue;
						var indCourse=ti[4],nbClasses=ti[2],nbPartants=ti[3];
						majSpanVariable(1,nbPartants,indCourse);
						majSpanVariable(2,nbClasses,indCourse);
					}
					break;
				case "CL": case "CLX": case "G": case "Q": // clt - clt filtré sur course/sexe - clt général - clt/équipes
					var selecteur='classement'; if (td[0]=='G') selecteur='general'; if (td[0]=='Q') selecteur='cltEquipes';
					$("div.widget["+selecteur+"='1']").each(function(ind){
						var widget=CFG.DicWidgets[this.id], s='';
						var indCourse=getCourseWidget(widget);
						var indDebItems=1,nb=0;
						// traitement filtre course/sexe
						if (td[0]=='CLX') {
							var idClt=td[1],infosClt=idClt.split('.'),indCourseClt=infosClt[0],sxClt=infosClt[1],indPtgClt=infosClt[2],indTronconClt=infosClt[3];
							if (indCourseClt!=indCourse || sxClt!=widget.sexe || indPtgClt!=widget.indPointage || indTronconClt!=widget.indTroncon) return;
							indDebItems=2;
						} else if (td[0]=='CL') {
							if (indCourse!=-1 || widget.sexe!=0 || (widget.indPointage!=999 && widget.indPointage!=-1) || widget.indTroncon!=-1) return;
						}
						for(i=indDebItems;i<td.length;i++){
							nb++;
							if (nb>widget.nbLignes) continue;
							var ti=td[i].split('\244');
							if (ti[1]==und) continue;
							s+='<div>';
							for (j=0;j<widget.colonnes.length;j++){
								var col=widget.colonnes[j],v='',vbrute='';
								if (td[0]=='Q') {
									// trame #Q#
									switch(Num(col.champ)){
										case 30: v=i; break; //place
										case 7: v=ti[1]; break; //équipe
										case 22: v=ti[2]; break; //temps
										case 9: v=ti[6]; break; //nationalité
										case 62: if(ti[6]>'') v='<img '+flag(ti[6],ti[8],16)+' style="vertical-align:middle"/> '; vbrute=ti[6]; break; //drapeau
										case 47: v=ti[9]; break; //tours
										case 48: var d=ti[7]; if(d>'')d=mefDist(d); v=d; vbrute=ti[7]; break; //distance
									}
								} else {
									// trame #G#
									switch(Num(col.champ)){
										case 30: v=ti[0]; break; //place
										case 21: v=ti[1]; break; //dossard
										case 4: v=ti[2].replace('\xa0',' '); break; //nom
										case 2: v=getNom(ti[2]); break; //nom
										case 3: v=getPrenom(ti[2]); break; //prenom
										case 68: v=getNomprenomInitiales(ti[2]); break;
										case 7: v=ti[7]; break; //équipe
										case 22: v=ti[3]; break; //temps
										case 34: v=ti[4]; if(ti[0]==1&&ti[4]=='')v=ti[3]; break; //écart
										case 8: v=ti[5]; break; //sexe
										case 9: v=ti[6]; break; //nationalité
										case 62: if(ti[6]>'') v='<img '+flag(ti[6],ti[12],16)+' style="vertical-align:middle"/> '; vbrute=ti[6]; break; //drapeau
										case 48: var d=ti[8]; if(d>'')d=mefDist(d); v=d; vbrute=ti[8]; break; //distance
										case 58: v=ti[9]; break; //meilleur tour
										case 47: v=ti[10]; break; //tours
										case 67: var cls=""; if(ti[11]==ti[9])cls="individualBestLap"; v='<span class="'+cls+'">'+ti[11]+'<span>'; vbrute=ti[11]; break; //dernier tour
									}
									if (Num(col.champ)>=100 && ti.length>=20){ //info perso
										var vips=ti[19];
										if(vips>''){
											try{
												var idip='ip'+(Num(col.champ)-100), oips=JSON.parse(vips); if(oips[idip]!=undefined) v=oips[idip];
											} catch(e){console.log('t_ips : '+e)}
										}
									}
								}
								if (vbrute=='') vbrute=v; if(vbrute==und) vbrute="";
								s+='<div class="col" style="' + styleCol(col,widget) + '" data="'+col.champ+'" val="' + (vbrute+'').replace(/"/g,'') + '">'
								 + v
								 +'</div>';
							}
							s+='</div>';
						}
						$(this.getElementsByClassName('liste')[0]).html(s);
					});
					break;
				case "R": case "RG": // passages récents, pour un pointage ou tous confondus
					$("div.widget[passagesrecents='1']").each(function(ind){
						var widget=CFG.DicWidgets[this.id];
						var indCourseWidget=getCourseWidget(widget);
						var bTousPtges=td[0]=="RG";
						var P=td[1].split('\r'),idPtg=P[0]; if(idPtg=='999')idPtg=-1;

						// filtre pointage général
						if(bTousPtges){
							if(widget.indPointage!=-2) return; //indPtg=-2 pour tous pointages
						}else{
							if(widget.indPointage!=idPtg) return;
						}

						var Tab=this.getElementsByClassName('liste')[0];
						var dossardsDejaDansTab=getDossardsDansTableau(Tab), dossardsAAjouter=[], dossardsRecus=[]; prems='',del=0;
						var infos=[];for(i=1;i<P.length;i++)infos.push(P[i].split("\xA4"));//xA4=¤
						// filtre course et pointage, par passage: retrait passages ko
						for(i=infos.length-1;i>=0;i--){
							var indCourse = infos[i][10], indPtgPassage = infos[i][14];
							if(indCourseWidget!=-1 && Num(indCourseWidget)!=Num(indCourse)) {infos.splice(i,1); continue;}
							if(CFG.Courses.length>1 && widget.indicesCourses!=undefined && !indiceDsListe(indCourse,widget.indicesCourses)) {infos.splice(i,1); continue;}
							//if(widget.indicesPointages!=undefined && !indiceDsListe(indPtgPassage,widget.indicesPointages)) {infos.splice(i,1); continue;}
						}
						for(i=0;i<infos.length;i++){
							dossardsRecus.push(infos[i][0]);
						}
						var simplePush=tabDansTab(dossardsRecus.slice().reverse(),dossardsDejaDansTab);
						var ind=0;
						for(i=dossardsDejaDansTab.length-1;i>=0;i--){
							//if($.inArray(dossardsDejaDansTab[i],dossardsRecus)==-1 /*|| ($.inArray(dossardsDejaDansTab[i],dossardsRecus)!=ind && $.inArray(dossardsDejaDansTab[i],dossardsRecus)!=ind+1 && $.inArray(dossardsDejaDansTab[i],dossardsRecus)!=ind-1)*/){
							if($.inArray(dossardsDejaDansTab[i],dossardsRecus)==-1 || ($.inArray(dossardsDejaDansTab[i],dossardsRecus)!=ind && !simplePush) ){
								Tab.removeChild(Tab.children[i]); del=1;
							}
							ind++;
						}
						if (del) dossardsDejaDansTab=getDossardsDansTableau(Tab);
						if (dossardsDejaDansTab.length>0) prems=dossardsDejaDansTab[dossardsDejaDansTab.length-1];
						for(i=0;i<dossardsRecus.length;i++){
							if(dossardsRecus[i]==prems)break;
							dossardsAAjouter.push(i)
						}
						for(i=dossardsAAjouter.length-1;i>=0;i--){
							insPsge(Tab,getRowPsg(infos[i],P[i+1],widget));
						}
						while(Tab.children.length>widget.nbLignes)
							Tab.removeChild(Tab.children[0]);
						dossardsDejaDansTab=getDossardsDansTableau(Tab); dossardsDejaDansTab.reverse(); 
						del=0;
						for(i=dossardsDejaDansTab.length-1;i>=0;i--){
							if($.inArray(dossardsDejaDansTab[i],dossardsDejaDansTab)!=i){
								Tab.removeChild(Tab.children[i]); del=1}
						} 
						if(del){dossardsDejaDansTab=getDossardsDansTableau(Tab);dossardsDejaDansTab.reverse();}
						for(i=0;i<Tab.children.length;i++){
							d=Tab.children[i].getAttribute('d'); 
							for(j=0;j<infos.length;j++){
								if(infos[j][0]==d){
									if(Tab.children[i].getAttribute('infos')!=P[j+1]) 
										Tab.children[i].outerHTML=getRowPsg(infos[j],P[j+1],widget); 
									break
								}
							}
						}
					});
					break;
				case "SN": case "AN": case "S": case "A": // [nb] coureurs au départ, [nb] coureurs attendus
					var selecteur=(td[0]=='SN'||td[0]=='S'?'coureursAuDepart':'coureursAttendus');
					$("div.widget["+selecteur+"='1']").each(function(ind){
						var widget=CFG.DicWidgets[this.id], s='', liste=this.getElementsByClassName('liste')[0];;
						if (td[0]=='SN'||td[0]=='AN') {
							var nb=Num(td[1]);
							while(liste.children.length<nb) liste.insertAdjacentHTML('beforeend','<div></div>');
							while(liste.children.length>nb) liste.removeChild(liste.childNodes[liste.childNodes.length-1]);
							return;
						}
						var ind=Num(td[1]),attendus=td[0]=='A',nom=td[3];
						if(nom==und)nom='';
						for (j=0;j<widget.colonnes.length;j++){
							var col=widget.colonnes[j], v='', vbrute='';
							// trame #A#
							switch(Num(col.champ)){
								case 30: v=td[(attendus?5:1)]; break; //place
								case 21: v=td[2]; break; //dossard
								case 4: v=nom.replace('\xa0',' '); break; //nom-prénom
								case 2: v=getNom(nom); break; //nom
								case 3: v=getPrenom(nom); break; //prenom
								case 68: v=getNomprenomInitiales(nom); break;
								case 7: v=td[6]; break; //club
								case 22: v=td[4]; break; //temps
								case 8: v=td[5]; break; //sexe
								case 9: v=td[7]; break; //nationalité
								case 62: if(td[7]>'') v='<img '+flag(td[7],td[8],16)+' style="vertical-align:middle"/> '; vbrute=td[7]; break; //drapeau
								//case 48: var d=td[8]; if(d>'')d=mefDist(d); s+=d; break; //distance
								//case 58: s+=td[9]; break; //meilleur tour
								//case 47: s+=td[10]; break; //tours
								//case 67: var cls=""; if(td[11]==td[9])cls="individualBestLap"; s+='<span class="'+cls+'">'+td[11]+'<span>'; break; //dernier tour
							}
							if (vbrute=='') vbrute=v; if(vbrute==und) vbrute="";
							s+='<div class="col" style="' + styleCol(col,widget) + '" data="'+col.champ+'" val="' + (vbrute+'').replace(/"/g,'') + '">'
								+ v
								+'</div>';
						}
						liste.childNodes[ind].innerHTML=s;
					});
					break;

			}
		}catch(e){console.log('infolive '+td[0]+' : '+e)}
	}
	function styleCol(col,widget){
		var s="width:"+col.lg+"px;max-width:"+col.lg+"px";
		if(col.fg) s+=';color:'+col.fg;
		if(col.bg) s+=';background-color:'+col.bg;
		if(col.align!=und) s+=';text-align:'+col.align; if(col.align=='center') s+=';padding-left:0;padding-right:0'
		if(col.style!=und) s+=';'+col.style.replace('"','');
		return s;
	}
	function getDossardsDansTableau(Tab){var T=[];for(var i=0;i<Tab.children.length;i++)T.push(Tab.children[i].getAttribute('d'));return T}
	function getRowPsg(infos,traceinfos,widget){
		// trame #C#
		var dos=infos[0],place=infos[3],temps=infos[2],nom=infos[1],ecart=infos[15],sexe=infos[9],femme=sexe=='F'||sexe==2,mx=sexe=='X'||sexe==3,club=infos[5],course=infos[4],plcat=infos[7],
		 indCourse=infos[10],categorie=infos[6],nationalite=infos[11],ptg=infos[14],nbtours=infos[12],dist=infos[16],meilleurTour=infos[17],dernierTour=infos[18],
		 sTours=txt(45)+'&nbsp;'+nbtours,paysiso=infos[20];
		 if(infos[13]==1)sTours=txt(17);
		 if(dist>'')dist=mefDist(dist);
		 if(nom==und)nom='';
		var s='<div d="'+dos+'" infos="'+traceinfos+'"' + (widget.indCourse<0&&CFG.Courses.length>1?' class="crs'+indCourse+'"':'') + ' sx="'+sexe+'">';
		for(var i=0;i<widget.colonnes.length;i++){
			var col=widget.colonnes[i],v='',vbrute='';
			switch(Num(col.champ)){
				case 30: v=place; break; //place
				case 31: v=plcat; break; //place/cat
				case 21: v=dos; break; //dossard
				case 4: v=nom.replace('\xa0',' '); break; //nom-prenom
				case 2: v=getNom(nom); break; //nom
				case 3: v=getPrenom(nom); break; //prenom
				case 68: v=getNomprenomInitiales(nom); break;
				case 22: v=temps; break; //temps
				case 34: v=ecart; if(place==1&&ecart=='')v=temps; break; //écart
				case 8: v=sexe; break; //sexe
				case 9: v=nationalite; break; //nationalité
				case 62: if(nationalite>'')v='<img '+flag(nationalite,paysiso,16)+' style="vertical-align:middle"/> '; vbrute=nationalite; break; //drapeau
				case 7: v=club; break; //club
				case 19: v=CFG.Courses[indCourse]; break; //course
				case 5: v=categorie; break; //catégorie
				case 47: v=nbtours; break; //nbtours
				case 55: case 44: v=ptg; break; //pointage
				case 48: v=dist; break; //distance
				case 58: v=meilleurTour; break; //meilleur tour
				case 67: var cls=""; if(dernierTour==meilleurTour)cls="individualBestLap"; v='<span class="'+cls+'">'+dernierTour+'<span>'; vbrute=dernierTour; break; //dernier tour
			}
			if (Num(col.champ)>=100 && infos.length>=20){ //info perso
				var vips=infos[19];
				if(vips>''){
					try{
						var idip='ip'+(Num(col.champ)-100), oips=JSON.parse(vips); if(oips[idip]!=undefined) v=oips[idip];
					} catch(e){console.log('t_ips : '+e)}
				}
			}
			if (vbrute=='') vbrute=v;
			if (v==undefined) v='';
			if (vbrute==undefined) vbrute='';
			s+='<div class="col" style="' + styleCol(col,widget) + '" data="'+col.champ+'" val="' + (vbrute+'').replace(/"/g,'') + '">'
			 + v
			 +'</div>';
		}
		return s + '</div>';
	}
	function insPsge(obj,h){
		var r=$(h);
		//r.hide();
		$(obj).append(r);
		r.find('>div').wrapInner('<div style="display: none;" />').parent().find('>div>div').slideDown(500,function(){var $s=$(this);$s.replaceWith($s.contents())});
	}
	function flag(nat,codeiso,taille){
		try{
			var n=nat; if(codeiso!=und&&codeiso>'')n=codeiso; else n=n.toUpperCase();
			if(Countries[n]!=und)n=Countries[n];FLG=n;return 'src="flag/'+taille+'/'+n+'.png"'
		}catch(e){}}
	function getCourseWidget(widget){
		var ind=CFG.courseActive;
		if (widget.indCourse!=und) ind=widget.indCourse;
		if (ind==und) ind=-1;
		if (ind==-2) ind=-1; //....-2 pour automatique
		if (ind+1>CFG.Courses.length) ind=CFG.Courses.length-1;
		if (CFG.Courses.length==0) ind=-1;
		return ind;
	}
	function majSpanVariable(idVar,val,indCourse){
		$("div.widget span[variable='"+idVar+"']").each(function(ind){
			var o=this; while (o!=null && o.className!='widget') o=o.parentElement;
			if (o==null) exit;
			var widget=CFG.DicWidgets[o.id];
			var indCourseWidget=getCourseWidget(widget);
			if (indCourse!=indCourseWidget) return;
			$(this).html(val);
			$(this).attr('val',val);
		});
	}
	function majLibellesCourse(){
		if(CFG.Courses.length>1){
			majSpanVariable(9,CFG.Courses[CFG.courseActive],-1); // course active, niveau général
			for(i=0;i<CFG.Courses.length;i++) majSpanVariable(9,CFG.Courses[i],i); // par widget
		}
	}
	function majLibellePtgTron(){
		$("div.widget span[variable='10']").each(function(ind){
			var o=this; while (o!=null && o.className!='widget') o=o.parentElement; if (o==null) exit;
			var widget=CFG.DicWidgets[o.id],val='';
			if(widget.indPointage!=undefined&&widget.indPointage>=0){if(widget.indPointage<CFG.Pointages.length)val=CFG.Pointages[widget.indPointage]; }
			if(widget.indTroncon!=undefined&&widget.indTroncon>=0){if(widget.indTroncon<CFG.Troncons.length)val=CFG.Troncons[widget.indTroncon]; }
			if(val==''&&widget.indPointage==-1)val=txt(17);
			$(this).html(val);
		});
	}
	function tabDansTab(master,sub){var idx=0,found=sub.every(function(a){var i=master.indexOf(a,idx);if(~i){idx=i;return true}});return found}
 </script>
</head>

<body onload="loadConfig()">

</body>
</html>